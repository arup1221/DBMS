CREATE DATABASE COMPANY;
USE COMPANY;

CREATE TABLE EMPLOYEE 
( 
SSN CHAR(9), 
NAME VARCHAR(20),
ADDRESS VARCHAR(25), 
SEX CHAR,
SALARY DOUBLE, 
SUPERSSN CHAR(9), 
DNO INT,
CONSTRAINT PK_A PRIMARY KEY(SSN),
CONSTRAINT FK_B FOREIGN KEY(SUPERSSN) REFERENCES EMPLOYEE(SSN) ON 
DELETE CASCADE
);

CREATE TABLE DEPARTMENT 
( 
DNO INT,
DNAME VARCHAR(15), 
MGRSSN CHAR(9), 
MGRSTARTDATE DATE,
CONSTRAINT PK_C PRIMARY KEY(DNO),
CONSTRAINT FK_D FOREIGN KEY(MGRSSN) REFERENCES EMPLOYEE(SSN) ON 
DELETE CASCADE
);

CREATE TABLE DLOCATION 
( 
DNO INT,
DLOC VARCHAR(15),
CONSTRAINT CPK_E PRIMARY KEY (DNO,DLOC),
CONSTRAINT FK_F FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO) ON 
DELETE CASCADE
);

CREATE TABLE PROJECT 
(
PNO INT,
PNAME VARCHAR(15), 
PLOCATION VARCHAR(15), 
DNO INT,
CONSTRAINT PK_G PRIMARY KEY(PNO),
CONSTRAINT FK_H FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO) ON 
DELETE CASCADE
);


CREATE TABLE WORKS_ON
(
SSN CHAR(9),
PNO INT, 
HOURS INT,
CONSTRAINT CPK_I PRIMARY KEY (SSN,PNO),
CONSTRAINT FK_J FOREIGN KEY (SSN) REFERENCES EMPLOYEE (SSN) ON DELETE 
CASCADE,
CONSTRAINT FK_K FOREIGN KEY (PNO) REFERENCES PROJECT (PNO) ON DELETE 
CASCADE
);

INSERT INTO EMPLOYEE(SSN, NAME, ADDRESS, SEX, SALARY) 
VALUES
(123456789, 'ASHA', 'YELAHANKA', 'F', 500000),
(234567891, 'SHEELA', 'JAKPUR', 'F', 700000),
(345678912, 'PALLAVI', 'NEWTOWN', 'F', 700000),
(456789123, 'SHREYAS', 'BASAWESWAR', 'M', 750000),
(567891234, 'MOHAN', 'TUMKUR', 'M', 350000),
(678912345, 'SCOTT', 'NEWYORK', 'M', 1000000),
(789123456, 'DIVYA', 'HUNSMARENHALLI', 'F', 350000),
(891234567, 'SAPNA', 'VIDYARANYAPURA', 'F', 350000),
(912345678, 'REVAN', 'MADIWALA', 'M', 450000),
(112233445, 'SAVITHA', 'DBSANDRA', 'F', 700000),
(223344556, 'VIJAY', 'VIJAYPURA', 'M', 600000),
(334455667, 'MANDHAR', 'JAYMAHAL', 'M', 500000),
(445566778, 'RAGHAV', 'YELAHANKA', 'M', 600000);

INSERT INTO DEPARTMENT(DNO, DNAME, MGRSSN, MGRSTARTDATE) 
VALUES
(1, 'CSE', 234567891, '2010-01-01'),
(2, 'ISE', 345678912, '2011-02-15'),
(3, 'ECE', 456789123, '2012-03-01'),
(4, 'ACCOUNTS', 678912345, '2013-04-15'),
(5, 'TCE', 123456789, '2014-05-02'),
(6, 'ECE', 567891234, '2015-06-15');

-- Update ASHA's record
UPDATE EMPLOYEE 
SET SUPERSSN = 234567891, DNO = 1 
WHERE SSN = 123456789;

-- Update SHEELA's record
UPDATE EMPLOYEE 
SET SUPERSSN = 678912345, DNO = 2 
WHERE SSN = 234567891;

-- Update PALLAVI's record
UPDATE EMPLOYEE 
SET SUPERSSN = 234567891, DNO = 3 
WHERE SSN = 345678912;

-- Update SHREYAS's record
UPDATE EMPLOYEE 
SET SUPERSSN = 234567891, DNO = 4 
WHERE SSN = 456789123;

-- Update MOHAN's record
UPDATE EMPLOYEE 
SET SUPERSSN = 678912345, DNO = 5 
WHERE SSN = 567891234;

-- Update SCOTT's record
UPDATE EMPLOYEE 
SET SUPERSSN = NULL, DNO = 6 
WHERE SSN = 678912345;

-- Update DIVYA's record
UPDATE EMPLOYEE 
SET SUPERSSN = 223344556, DNO = 2 
WHERE SSN = 789123456;

-- Update SAPNA's record
UPDATE EMPLOYEE 
SET SUPERSSN = 112233445, DNO = 2 
WHERE SSN = 891234567;

-- Update REVAN's record
UPDATE EMPLOYEE 
SET SUPERSSN = 123456789, DNO = 2 
WHERE SSN = 912345678;

-- Update SAVITHA's record
UPDATE EMPLOYEE 
SET SUPERSSN = 234567891, DNO = 2 
WHERE SSN = 112233445;

-- Update VIJAY's record
UPDATE EMPLOYEE 
SET SUPERSSN = 345678912, DNO = 2 
WHERE SSN = 223344556;

-- Update MANDHAR's record
UPDATE EMPLOYEE 
SET SUPERSSN = 456789123, DNO = 4 
WHERE SSN = 334455667;

-- Update RAGHAV's record
UPDATE EMPLOYEE 
SET SUPERSSN = 345678912, DNO = 4 
WHERE SSN = 445566778;

SELECT * FROM EMPLOYEE;


INSERT INTO DLOCATION (DNO, DLOC)
VALUES
    (1, 'NB1'),
    (2, 'NB0'),
    (3, 'NB2'),
    (4, 'NB1'),
    (5, 'NB3'),
    (6, 'EEE2');
    
INSERT INTO PROJECT (PNO, PNAME, PLOCATION, DNO)
VALUES
    (11, 'JAVA', 'MARATHAHALLI', 1),
    (22, 'DOTNET', 'HEBBAL', 2),
    (33, 'IOT', 'MANYATA', 3),
    (44, 'ANDROID', 'YELAHANKA', 4),
    (55, 'BIGDATA', 'KR PURAM', 5),
    (66, 'WEB', 'ELECTRONIC CITY', 6);
    
INSERT INTO WORKS_ON VALUES(678912345,11,25);
INSERT INTO WORKS_ON(SSN,PNO,HOURS) VALUES
(123456789,22,25),
(234567891,33,26),
(678912345,44,27),
(345678912,55,25),
(456789123,66,25);

-- QUERY 1
(SELECT DISTINCT P.PNO
FROM PROJECT P,DEPARTMENT D,EMPLOYEE E
WHERE P.DNO=D.DNO AND D.MGRSSN=E.SSN AND E.NAME='SCOTT') 
UNION
(SELECT DISTINCT P.PNO
FROM PROJECT P,WORKS_ON W,EMPLOYEE E
WHERE P.PNO=W.PNO AND W.SSN=E.SSN AND E.NAME='SCOTT');


-- QUERY 2 
SELECT E.NAME,1.1*E.SALARY AS HIKE_SALARY 
FROM EMPLOYEE E,WORKS_ON W,PROJECT P
WHERE E.SSN=W.SSN AND P.PNO=W.PNO AND P.PNAME='IOT';


-- QUERY 3
SELECT SUM(E.SALARY) AS SUM_SAL,MAX(E.SALARY) AS MAX_SAL,MIN(E.SALARY) AS 
MIN_SAL,AVG(E.SALARY) AS AVG_SAL
FROM EMPLOYEE E,DEPARTMENT D
WHERE E.DNO=D.DNO AND D.DNAME='ACCOUNTS';

-- QUERY 4
SELECT E.NAME FROM EMPLOYEE E 
WHERE NOT EXISTS(SELECT*
FROM WORKS_ON W1
WHERE (W1.PNO IN(SELECT P.PNO
FROM PROJECT P 
WHERE P.DNO=5)
AND
NOT EXISTS(SELECT*
FROM WORKS_ON W2
WHERE W2.SSN=E.SSN AND W2.PNO=W1.PNO)));




-- QUERY 5
SELECT DNO,COUNT(*) AS NO_OF_EMP 
FROM EMPLOYEE
WHERE SALARY>600000 AND DNO IN(SELECT DNO
FROM EMPLOYEE 
GROUP BY(DNO) 
HAVING COUNT(*)>5)
GROUP BY DNO;