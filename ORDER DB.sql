CREATE DATABASE ORDERS;
USE ORDERS;

CREATE TABLE SALESMAN
( 
	SALESMAN_ID INT, 
	NAME VARCHAR(15),
	CITY VARCHAR(15), 
	COMISSION DOUBLE,
	CONSTRAINT PK_A PRIMARY KEY(SALESMAN_ID)
);

DESC SALESMAN;

CREATE TABLE CUSTOMER
(  
	CUSTOMER_ID INT, 
	CUST_NAME VARCHAR(15),
	CITY VARCHAR(15), 
	GRADE INT,
	SALESMAN_ID INT,
	CONSTRAINT PK_B PRIMARY KEY(CUSTOMER_ID), 
	CONSTRAINT FK_D FOREIGN KEY(SALESMAN_ID)REFERENCES SALESMAN(SALESMAN_ID)ON DELETE SET NULL
);

DESC CUSTOMER;

CREATE TABLE ORDERS
( 
	ORD_NO INT, 
	PURCHASE_AMT DOUBLE, 
	ORD_DATE DATE, 
	CUSTOMER_ID INT, 
	SALESMAN_ID INT,
	CONSTRAINT PK_E PRIMARY KEY(ORD_NO),
	CONSTRAINT FK_G FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE SET NULL, 
	CONSTRAINT FK_H FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE SET NULL
);

INSERT INTO SALESMAN
(SALESMAN_ID,NAME,CITY,COMISSION)
VALUES
(1000,'RAMA','BANGALORE',10000.75),
(2000,'KRISHNA','MATHURA',20000.25),
(3000,'SHIVA','AMARNATH',30000.3),
(4000,'GOVINDA','TIRUPATHI',4000.4),
(5000,'NARAYANA','VELLORE',50000.5);

SELECT * FROM SALESMAN;

INSERT INTO CUSTOMER
(CUSTOMER_ID,CUST_NAME,CITY,GRADE,SALESMAN_ID)
VALUES
(10,'GANESH','BANGALORE',100,1000),
(20,'SUDHEEP','BANGALORE',200,2000),
(30,'PRABHAS','HYDERABAD',300,3000),
(40,'ARVIND','CHENNAI',400,4000),
(50,'DARSHAN','BANGALORE',500,2000),
(60,'YASH','BANGALORE',600,1000);

SELECT * FROM CUSTOMER;

INSERT INTO ORDERS 
(ORD_NO,PURCHASE_AMT,ORD_DATE,CUSTOMER_ID,SALESMAN_ID)
VALUES
(1111,100000,'2017-01-01',10,2000),
(2222,200000,'2017-02-21',20,3000),
(3333,300000,'2017-03-15',30,4000),
(4444,400000,'2017-04-18',40,5000),
(5555,500000,'2017-05-12',10,1000),
(6666,600000,'2017-05-12',10,1000);

SELECT COUNT(CUSTOMER_ID) 
FROM CUSTOMER
WHERE GRADE>( SELECT AVG(GRADE)
FROM CUSTOMER
WHERE CITY='BANGALORE' );

SELECT S.NAME,S.SALESMAN_ID 
FROM SALESMAN S,CUSTOMER C
WHERE S.SALESMAN_ID=C.SALESMAN_ID 
GROUP BY S.NAME,S.SALESMAN_ID 
HAVING COUNT(C.CUSTOMER_ID)>1;

(SELECT S.SALESMAN_ID,S.NAME,C.CUST_NAME 
FROM SALESMAN S,CUSTOMER C
WHERE S.CITY=C.CITY AND S.SALESMAN_ID=C.SALESMAN_ID) 
UNION
(SELECT S1.SALESMAN_ID,S1.NAME,'NO CUSTOMER' 
FROM SALESMAN S1,CUSTOMER C1
WHERE S1.CITY!=C1.CITY AND S1.SALESMAN_ID=C1.SALESMAN_ID );

CREATE VIEW HIGH_ORDER_DAY AS
SELECT O.ORD_DATE,S.SALESMAN_ID,S.NAME,C.CUST_NAME,O.PURCHASE_AMT 
FROM ORDERS O,SALESMAN S,CUSTOMER C
WHERE O.SALESMAN_ID=S.SALESMAN_ID AND C.CUSTOMER_ID=O.CUSTOMER_ID;

SELECT * FROM HIGH_ORDER_DAY H
WHERE H.PURCHASE_AMT=(SELECT MAX(H1.PURCHASE_AMT)
FROM HIGH_ORDER_DAY H1
WHERE H1.ORD_DATE=H.ORD_DATE);

DELETE FROM SALESMAN WHERE SALESMAN_ID=1000;
SELECT * FROM CUSTOMER;
SELECT * FROM ORDERS;
SELECT * FROM SALESMAN;


